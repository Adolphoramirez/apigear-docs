"use strict";(self.webpackChunkapigear=self.webpackChunkapigear||[]).push([[8049],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=o,h=m["".concat(l,".").concat(d)]||m[d]||p[d]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4264:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(7462),o=(n(7294),n(3905));const r={sidebar_position:2},i="Scenario Documents",s={unversionedId:"advanced/simulation/scenario",id:"advanced/simulation/scenario",title:"Scenario Documents",description:"A scenario is a document describing the data and behavior of one or more services for the simulation server. The simulation server is embedded into the ApiGear Studio tool. The simulation server can be used using the simulation protocol over HTTP or WebSockets. Support for the simulation protocol does come with most of ApiGear template Templates.",source:"@site/docs/advanced/simulation/scenario.md",sourceDirName:"advanced/simulation",slug:"/advanced/simulation/scenario",permalink:"/docs/advanced/simulation/scenario",draft:!1,editUrl:"https://github.com/apigear-io/apigear-docs/edit/main/docs/advanced/simulation/scenario.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Introduction",permalink:"/docs/advanced/simulation/intro"},next:{title:"Network Protocols",permalink:"/docs/advanced/simulation/protocols"}},l={},c=[{value:"Variables",id:"variables",level:2},{value:"Action",id:"action",level:2},{value:"Playbooks",id:"playbooks",level:2},{value:"Schema Data",id:"schema-data",level:2}],u={toc:c};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"scenario-documents"},"Scenario Documents"),(0,o.kt)("p",null,"A scenario is a document describing the data and behavior of one or more services for the simulation server. The simulation server is embedded into the ApiGear Studio tool. The simulation server can be used using the simulation protocol over HTTP or WebSockets. Support for the simulation protocol does come with most of ApiGear template Templates."),(0,o.kt)("p",null,"It can provide simulation to one or more services and their operation endpoints. The format of a scenario is described here."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'schema: apigear.scenario/1.0\nname: "count scenario"\nversion: "1.0"\ninterfaces:\n  - name: demo.Counter\n    state:\n      count: { value: 0 }\n    methods:\n      - name: increment\n        actions:\n          - add: [$state.count, $params.step]\n      - name: decrement\n        actions:\n          - add: [$state.count, $params.step]\n')),(0,o.kt)("h2",{id:"variables"},"Variables"),(0,o.kt)("p",null,"In actions you can reference the state and an operation parameters using the ",(0,o.kt)("inlineCode",{parentName:"p"},"$state")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"$params")," prefix. You can use them to read the value of the variable or to write to the variable."),(0,o.kt)("h2",{id:"action"},"Action"),(0,o.kt)("p",null,"At several places the scenario uses action sequences. A sequence is a list of actions each action is an object with a key of the action command and a array value as the action arguments."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"- command: [argument list]\n")),(0,o.kt)("p",null,"When an action changes the state a state changed notification will automatically be send after all actions of the sequence have been run."),(0,o.kt)("p",null,"Typical actions are"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"set")," sets a value ",(0,o.kt)("inlineCode",{parentName:"li"},"- set: [$state.count, 5 ]")," - similar the ",(0,o.kt)("inlineCode",{parentName:"li"},"state.count = 5")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"signal")," emits a signal from the simulation: ",(0,o.kt)("inlineCode",{parentName:"li"},"- signal: [ shutdown, { timeout: 5 }]")," similar to ",(0,o.kt)("inlineCode",{parentName:"li"},"signal('shutdown', { timeout: 5} )"))),(0,o.kt)("p",null,"other actions are ",(0,o.kt)("inlineCode",{parentName:"p"},"add"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"sub"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"mult"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"div"),". There are more to come."),(0,o.kt)("h2",{id:"playbooks"},"Playbooks"),(0,o.kt)("p",null,"A playbook is a time based execution of actions. A playbook has a name and can be triggered from an action or can run automatically on simulation start."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"playbooks:\n  - name: increment counter\n    interval: 2000 # 2 seconds\n    loop: true # start over when at end\n    steps: # step is called every 2 secs according to interval\n      - name: increment\n        actions: # list of actions\n          - set: [$state.count, 1]\n          - signal: [shutdown, 10]\n      - name: clear\n        actions:\n          - set: [$state.count, 0]\n          - signal: [shutdown, 7]\n")),(0,o.kt)("p",null,"The interval defined the tick and on each tick a step is running. If loops is true then the playbook will start again after finished."),(0,o.kt)("h2",{id:"schema-data"},"Schema Data"),(0,o.kt)("p",null,"When a state or return statement defines a value it can be defined as static value using the ",(0,o.kt)("inlineCode",{parentName:"p"},"value")," notation or it can also be mocked using a ",(0,o.kt)("inlineCode",{parentName:"p"},"schema")," notation."),(0,o.kt)("p",null,"For example to create a random count value you can between 0 and 100 you can create a schema."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'schema: apigear.scenario/1.0\nname: "count scenario"\nversion: "1.0"\ninterfaces:\n  - name: demo.Counter\n    properties:\n      count:\n        schema:\n          type: integer\n          minimum: 0\n          maximum: 100\n')),(0,o.kt)("p",null,"Now on every call to retrieve the service state it will return a number between 0 and 100."))}m.isMDXComponent=!0}}]);